---
layout: default
title: 19_Настроим мониторинг (Prometheus + Grafana + Victoria Metrics)
---
<a class="back-link" href="index.html">⬅ Назад к списку</a>


##  Настроим мониторинг (Prometheus + Grafana + Victoria Metrics) 

02-10-2025, 02:27 PM

Источник [тут](http://victoriametrics-an-overview-and-its-use-instead-of-prometheus)  
Источник [тут](https://www.dmosk.ru/miniinstruktions.php?mini=victoriametrics&ysclid=m6yy0dp8bo581220418)  
Источник [тут](https://www.dmosk.ru/miniinstruktions.php?mini=prometheus-stack-docker&ysclid=m708vq6p9j537575351)  
  
  
vCPU = 4  
vRAM = 4 Gb  
vHDD = 40 Gb  
  
**Подготовим 1 виртуальную машину**  
  
Клонируем шаблон k8s-UbuntuTemplate  
  
Меняем IP и имена хостов на каждом узле  
  


Код:
    
    
    rm /etc/resolv.conf && nano /etc/resolv.conf

Код:
    
    
    nameserver 20.20.20.2

Код:
    
    
    nano /etc/netplan/01-netcfg.yaml

Код:
    
    
    20.20.20.61

Код:
    
    
    nano /etc/hostname

Код:
    
    
    prometeus

Код:
    
    
    reboot

**1\. Установка Docker & Docker-Compose**  
  
Инструкция [тут](https://forum.kubeadm.ru/node/398)  
  
**2\. Скачиваем и распаковываем архив**  
  
Копируем содержимое [**архива**](https://galkin-vladimir.ru:5446/d/s/13O9get9acQhR70YNlhRJM9g63ZIiqzY/8uu9OxS3H1EmUHqMj2Mgj0GgLslXPOCs-FrNgYAfPSAw)  
  


Код:
    
    
    nano /media/data/prometheus.yml

Код:
    
    
    nano /media/data/alert_rules.yml

Код:
    
    
    nano /media/data/config.yml

Код:
    
    
    nano /media/data/blackbox.yml

Код:
    
    
    nano /root/docker-compose.yml

Код:
    
    
    docker-compose up -d

**!!! Ждем завершение процесса !!!**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 13.14.14.png Просмотров:	0 Размер:	23.2 Кб ID:	4603](images\\img_4603_1739268911.png)  
  
**3\. Проверим**  
  
**Metrics**  
  


Код:
    
    
    http://20.20.20.61:9100/metrics

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.24.26.png Просмотров:	0 Размер:	86.8 Кб ID:	4582](images\\img_4582_1739197495.png)  
  
**Prometheus**  
  


Код:
    
    
    http://20.20.20.61:9090

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 13.54.25.png Просмотров:	0 Размер:	50.9 Кб ID:	4604](images\\img_4604_1739271452.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 14.49.26.png Просмотров:	0 Размер:	80.8 Кб ID:	4607](images\\img_4607_1739274617.png)  
  
**Alert Manager**  
  


Код:
    
    
    http://20.20.20.61:9093

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 14.45.37.png Просмотров:	0 Размер:	63.9 Кб ID:	4605](images\\img_4605_1739274415.png)  
  
  
**Victoria Metrics**  
  


Код:
    
    
    http://20.20.20.61:8428/vmui

Код:
    
    
    node_memory_MemTotal_bytes{server_name="prometheus"}

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 8.48.58.png Просмотров:	0 Размер:	33.8 Кб ID:	4593](images\\img_4593_1739252979.png)  
  
  
**Grafana**  
  


Код:
    
    
    http://20.20.20.61:3000

Код:
    
    
    login: admin
    pass: admin

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.22.15.png Просмотров:	0 Размер:	42.2 Кб ID:	4584](images\\img_4584_1739198474.png)  
  
**4\. Настроим подключения**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.39.14.png Просмотров:	0 Размер:	68.5 Кб ID:	4585](images\\img_4585_1739198517.png)  
  


Код:
    
    
    http://20.20.20.61:9090

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 14.52.51.png Просмотров:	0 Размер:	27.9 Кб ID:	4608](images\\img_4608_1739274818.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.44.42.png Просмотров:	0 Размер:	16.4 Кб ID:	4596](images\\img_4596_1739198708.png)  
  
**5\. Добавляем еще один источник**  
  


Код:
    
    
    Victoria Metrics

Код:
    
    
    http://20.20.20.61:8428

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 8.55.18.png Просмотров:	0 Размер:	28.1 Кб ID:	4594](images\\img_4594_1739253481.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.44.42.png Просмотров:	0 Размер:	16.4 Кб ID:	4587](images\\img_4587_1739198708.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 9.00.35.png Просмотров:	0 Размер:	58.2 Кб ID:	4595](images\\img_4595_1739253665.png)  
  
**6\. Загрузим готовую панель "Node Exporter"**  
  


Код:
    
    
    1860

**Для Prometeus**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.46.25.png Просмотров:	0 Размер:	44.2 Кб ID:	4588](images\\img_4588_1739198844.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.47.42.png Просмотров:	0 Размер:	8.5 Кб ID:	4589](images\\img_4589_1739198899.png)  
  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.48.54.png Просмотров:	0 Размер:	32.4 Кб ID:	4590](images\\img_4590_1739198980.png)  
  
Выбираем источник  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-10 в 17.51.12.png Просмотров:	1 Размер:	44.0 Кб ID:	4591](images\\img_4591_1739199140.png)  
  
**Для Victoria Metrics**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 9.05.27.png Просмотров:	0 Размер:	42.6 Кб ID:	4597](images\\img_4597_1739254085.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 9.10.40.png Просмотров:	0 Размер:	25.8 Кб ID:	4598](images\\img_4598_1739254280.png)  
  
Проверим  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 9.11.32.png Просмотров:	0 Размер:	107.4 Кб ID:	4599](images\\img_4599_1739254338.png)  
  
**6\. Настроим панель Blackbox**  
  


Код:
    
    
    7587

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 15.05.06.png Просмотров:	0 Размер:	32.1 Кб ID:	4611](images\\img_4611_1739275554.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 15.02.53.png Просмотров:	0 Размер:	45.1 Кб ID:	4609](images\\img_4609_1739275403.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2025-02-11 в 15.03.38.png Просмотров:	0 Размер:	88.0 Кб ID:	4610](images\\img_4610_1739275445.png)  
  
  
**Поздравляю! настройка завершена.**


---

