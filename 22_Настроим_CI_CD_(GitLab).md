---
layout: default
title: 22_Настроим CI_CD (GitLab)
---
<a class="back-link" href="index.html">⬅ Назад к списку</a>


##  Настроим CI/CD (GitLab) 

06-17-2023, 07:35 AM

**1\. Собираем свой "служебный" контейнер helm_kubectl**  
  
Заходим в консоль work  
  


Код:
    
    
    mkdir -p /root/helm_kubectl && cd /root/helm_kubectl

**!!! Имя домена вводим свое !!!**  
  


Код:
    
    
    nano Dockerfile

Код:
    
    
    FROM harbor.kubeadm.ru/mirror.docker.hub/library/ubuntu:focal
    
    RUN apt update && apt install -y curl wget
    RUN curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
    RUN chmod +x ./kubectl
    RUN mv ./kubectl /usr/local/bin/kubectl
    
    RUN wget https://get.helm.sh/helm-v3.12.1-linux-amd64.tar.gz
    RUN tar -zxvf helm-v3.12.1-linux-amd64.tar.gz
    RUN mv linux-amd64/helm /usr/local/bin/helm

**!!! Точка в конце строки обязательна !!!**  
  


Код:
    
    
    docker build --no-cache -t harbor.kubeadm.ru/library/helm_kubectl:latest **.**

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 16.52.42.png Просмотров:	0 Размер:	11.3 Кб ID:	4216](images\\img_4216_1732024400.png)  
  


Код:
    
    
    docker login -u admin -p Harbor12345 harbor.kubeadm.ru

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 16.57.16.png Просмотров:	0 Размер:	31.4 Кб ID:	4217](images\\img_4217_1732024683.png)  
  


Код:
    
    
    docker push harbor.kubeadm.ru/library/helm_kubectl:latest

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 16.58.28.png Просмотров:	0 Размер:	45.1 Кб ID:	4218](images\\img_4218_1732024745.png)  
  
**2\. Добавим новый проект в GitLab**  
  
Заходим в веб интерфейс GitLab  
  
**!!! Имя домена вводим свое !!!**  
  


Код:
    
    
    [https://gitlab.kubeadm.ru](https://gitlab.kubeadm.ru)

Код:
    
    
    myproject

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-06-17 в 8.14.54.png Просмотров:	0 Размер:	20.8 Кб ID:	1829](images\\img_1829_1686978975.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 17.00.41.png Просмотров:	0 Размер:	94.8 Кб ID:	4219](images\\img_4219_1732024905.png)  
  
**3\. Добавим переменные**  
  
**!!! Имя домена вводим свое !!!**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 17.08.20.png Просмотров:	0 Размер:	29.7 Кб ID:	4220](images\\img_4220_1732025371.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 17.09.52.png Просмотров:	0 Размер:	82.3 Кб ID:	4221](images\\img_4221_1732025456.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 17.11.16.png Просмотров:	0 Размер:	43.5 Кб ID:	4222](images\\img_4222_1732025510.png)  
  


Код:
    
    
    HARBOR_LOGIN
    
    admin

Код:
    
    
    HARBOR_TOKEN
    
    Harbor12345

Код:
    
    
    HARBOR_URL
    
    harbor.kubeadm.ru

Код:
    
    
    KUBE_CONFIG

Копируем содержимое из консоли master01  
  


Код:
    
    
    cat .kube/config

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 17.17.42.png Просмотров:	0 Размер:	89.8 Кб ID:	4224](images\\img_4224_1732026028.png)  
  
Проверка  
  
![Нажмите на изображение для увеличения.  Название:	49.png Просмотров:	0 Размер:	58.5 Кб ID:	1956](images\\img_1956_1688460847.png)  
  
**4\. Установим на свой ПК среду разработки (IDE)**  
  
  
_**[Visual Studio Code](https://code.visualstudio.com/download)**_  
  
  
**5\. Загружаем наш проект из GitLab**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 11.00.12.png Просмотров:	0 Размер:	36.0 Кб ID:	2261](images\\img_2261_1690358536.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 11.03.13.png Просмотров:	0 Размер:	107.0 Кб ID:	2262](images\\img_2262_1690358691.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 11.14.50.png Просмотров:	0 Размер:	55.2 Кб ID:	2263](images\\img_2263_1690359356.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.26.09.png Просмотров:	0 Размер:	15.8 Кб ID:	2276](images\\img_2276_1690363623.png)  
  
**6\. Добавляем в проект файлы из[архива](https://galkin-vladimir.ru:5446/d/s/10zswywPnW62p7Fj3njIcITb6UHjMFTt/oM8FDhG9Tg0ndwuMvBT0GtZJF0PPdrB_-rb9AyVzM1Qs)**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.35.53.png Просмотров:	0 Размер:	18.8 Кб ID:	2278](images\\img_2278_1690364249.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2024-11-19 в 17.33.57.png Просмотров:	0 Размер:	20.3 Кб ID:	4225](images\\img_4225_1732026909.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.37.42.png Просмотров:	0 Размер:	33.7 Кб ID:	2279](images\\img_2279_1690364382.png)  
  
**!!! Переименуем файл !!!**  
  
Спереди ставим точку  
  


Код:
    
    
    **.** gitlab-ci.yml

![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.40.13.png Просмотров:	0 Размер:	28.6 Кб ID:	2280](images\\img_2280_1690364452.png)  
  
**7\. Сохраним файлы в GitLab**  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.42.24.png Просмотров:	0 Размер:	27.7 Кб ID:	2281](images\\img_2281_1690364619.png)  
  
Сохраним свой комментарий  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.44.17.png Просмотров:	0 Размер:	44.1 Кб ID:	2282](images\\img_2282_1690364756.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.46.10.png Просмотров:	0 Размер:	26.6 Кб ID:	2283](images\\img_2283_1690364811.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.47.02.png Просмотров:	0 Размер:	18.4 Кб ID:	2284](images\\img_2284_1690364868.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.47.57.png Просмотров:	0 Размер:	23.3 Кб ID:	2285](images\\img_2285_1690364922.png)  
  
**8\. Проверим**  
  
В GitLab должны добавятся файлы проекта  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 12.49.07.png Просмотров:	0 Размер:	39.7 Кб ID:	2286](images\\img_2286_1690365006.png)  
  
И должен запуститься сборочная линия CI/CD  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 13.10.59.png Просмотров:	0 Размер:	101.8 Кб ID:	2287](images\\img_2287_1690366344.png)  
  
При благополучном исходе оба этапа завершаться выполнением  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 13.29.37.png Просмотров:	1 Размер:	6.7 Кб ID:	2290](images\\img_2290_1690367473.png)  
  
Проверим  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 13.31.30.png Просмотров:	1 Размер:	17.8 Кб ID:	2291](images\\img_2291_1690367542.png)  
  
![Нажмите на изображение для увеличения.  Название:	Снимок экрана 2023-07-26 в 13.32.34.png Просмотров:	1 Размер:	6.9 Кб ID:	2292](images\\img_2292_1690367649.png)  
  
**Поздравляю! настройка завершена.**

Вложения 

  * [ ![Нажмите на изображение для увеличения.



Название:	Снимок экрана 2023-06-18 в 9.45.58.png

Просмотров:	183

Размер:	139.5 Кб

ID:	1847](images\\img_1847_0.png) ](filedata/fetch?id=1847)




---

